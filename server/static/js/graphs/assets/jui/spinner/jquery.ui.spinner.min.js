(function(h,F){var g=h.ui.keyCode,r=g.UP,s=g.DOWN,k=g.RIGHT,t=g.LEFT,l=g.PAGE_UP,m=g.PAGE_DOWN,y=g.HOME,z=g.END,A=h.browser.msie,B=[r,s,k,t,l,m,y,z,g.BACKSPACE,g.DELETE,g.TAB],C;h.widget("ui.spinner",{options:{min:null,max:null,allowNull:!1,group:"",point:".",prefix:"",suffix:"",places:null,defaultStep:1,largeStep:10,mouseWheel:!0,increment:"slow",showOn:"always",upIconClass:"icon-caret-up",downIconClass:"icon-caret-down",format:function(a,b){for(var c=/(\d+)(\d{3})/,e=(isNaN(a)?0:Math.abs(a)).toFixed(b)+
"",e=e.replace(".",this.point);c.test(e)&&this.group;e=e.replace(c,"$1"+this.group+"$2"));return(0>a?"-":"")+this.prefix+e+this.suffix},parse:function(a){"."==this.group&&(a=a.replace(".",""));"."!=this.point&&(a=a.replace(this.point,"."));return parseFloat(a.replace(/[^0-9\-\.]/g,""))}},_create:function(){var a=this.element,b=a.attr("type");!a.is("input")||"text"!=b&&"number"!=b?console.error("Invalid target for ui.spinner"):(this._procOptions(),this._createButtons(a),a.addClass("spinner-input"),
a.is(":enabled")||this.disable())},_createButtons:function(a){function b(a){for(var b=0;b<B.length;b++)if(B[b]==a)return!0;return!1}function c(a){if(n){if(a===D)return;clearTimeout(n)}D=a;n=setTimeout(function(){n=0;a()},100)}function e(){u&&(d._stopSpin(),u=!1);return!1}var d=this,i=d.options,f=i.showOn,E=d.wrapper=a.wrap('<span class="spinner-container"></span>').parent(),v=d.btnContainer=h('<span class="spinner-btn-group btn-group btn-group-vertical"><span class="btn-spinner-up btn"><span class="'+
i.upIconClass+'"></span></span><span class="btn-spinner-down btn"><span class="'+i.downIconClass+'"></span></span></span>'),w,j,n,D,p,q,x,u,G="rtl"==a[0].dir;E.append(v);j=d.buttons=v.find(".btn");w=j[0];a.attr("class")!==F&&E.addClass(a.attr("class"));"always"!=f&&v.css("opacity",0);("hover"==f||"both"==f)&&j.add(a).bind("mouseenter.uispinner",function(){c(function(){p=!0;(!d.focused||"hover"==f)&&d.showButtons()})}).bind("mouseleave.uispinner",function(){c(function(){p=!1;(!d.focused||"hover"==
f)&&d.hideButtons()})});j.mousedown(function(){if(!i.disabled){var a=d.element[0],b=this===w?1:-1;a.focus();a.select();u=!0;d._startSpin(b)}return!1}).mouseup(e).mouseout(e);A&&j.dblclick(function(){i.disabled||(d._change(),d._doSpin((this===w?1:-1)*i.step));return!1}).bind("selectstart",function(){return!1});a.bind("keydown.uispinner",function(a){var c,e,f=a.keyCode;if(a.ctrl||a.alt)return!0;b(f)&&(x=!0);if(q)return!1;switch(f){case r:case l:c=1;e=f==l;break;case s:case m:c=-1;e=f==m;break;case k:case t:c=
f==k^G?1:-1;break;case y:return a=d.options.min,null!=a&&d._setValue(a),!1;case z:return a=d.options.max,null!=a&&d._setValue(a),!1}if(c)return!q&&!i.disabled&&(keyDir=c,q=!0,d._startSpin(c,e)),!1}).bind("keyup.uispinner",function(a){if(a.ctrl||a.alt)return!0;b(g)&&(x=!1);switch(a.keyCode){case r:case k:case l:case s:case t:case m:return d._stopSpin(),q=!1}}).bind("keypress.uispinner",function(a){if(x)a=!1;else var a=String.fromCharCode(a.charCode||a.keyCode),b=d.options,a="0"<=a&&"9">=a||"-"==a||
0<d.places&&a==b.point||a==b.group?!1:!0;if(a)return!1}).bind("change.uispinner",function(){d._change()}).bind("focus.uispinner",function(){function a(){d.element.select()}A?a():setTimeout(a,0);d.focused=!0;C=d;!p&&("focus"==f||"both"==f)&&d.showButtons()}).bind("blur.uispinner",function(){d.focused=!1;!p&&("focus"==f||"both"==f)&&d.hideButtons()})},_procOptions:function(){var a=this.element,b=this.options,c=b.min,e=b.max,d=b.step,g=b.places,f;"slow"==b.increment?b.increment=[{count:1,mult:1,delay:250},
{count:3,mult:1,delay:100},{count:0,mult:1,delay:50}]:"fast"==b.increment&&(b.increment=[{count:1,mult:1,delay:250},{count:19,mult:1,delay:100},{count:80,mult:1,delay:20},{count:100,mult:10,delay:20},{count:0,mult:100,delay:20}]);if(null==c&&null!=(f=a.attr("min")))c=parseFloat(f);if(null==e&&null!=(f=a.attr("max")))e=parseFloat(f);if(!d&&null!=(f=a.attr("step"))&&"any"!=f)d=parseFloat(f),b.largeStep*=d;b.step=d=d||b.defaultStep;if(null==g&&-1!=(f=d+"").indexOf("."))g=f.length-f.indexOf(".")-1;this.places=
g;null!=e&&null!=c&&c>e&&(c=e);b.min=c;b.max=e;this._change();b.mouseWheel&&h.fn.mousewheel&&a.mousewheel(this._mouseWheel)},_mouseWheel:function(a,b){var c=h.data(this,"spinner");if(!c.options.disabled&&c.focused&&C===c)return c._change(),c._doSpin(b*c.options.step),!1},_setTimer:function(a,b,c){var e=this;e._stopSpin();e.timer=setInterval(function(){e._spin(b,c)},a)},_stopSpin:function(){this.timer&&(clearInterval(this.timer),this.timer=0)},_startSpin:function(a,b){var c=this.options.increment;
this._change();this._doSpin(a*(b?this.options.largeStep:this.options.step));c&&0<c.length&&(this.incCounter=this.counter=0,this._setTimer(c[0].delay,a,b))},_spin:function(a,b){var c=this.options.increment,e=c[this.incCounter];this._doSpin(a*e.mult*(b?this.options.largeStep:this.options.step));this.counter++;this.counter>e.count&&this.incCounter<c.length-1&&(this.counter=0,e=c[++this.incCounter],this._setTimer(e.delay,a,b))},_doSpin:function(a){var b=this.curvalue;null==b&&(b=(0<a?this.options.min:
this.options.max)||0);this._setValue(b+a)},_parseValue:function(){var a=this.element.val();return a?this.options.parse(a,this.element):null},_validate:function(a){var b=this.options,c=b.min,e=b.max;null==a&&!b.allowNull&&(a=null!=this.curvalue?this.curvalue:c||e||0);return null!=e&&a>e?e:null!=c&&a<c?c:a},_change:function(){var a=this._parseValue();this.selfChange||(isNaN(a)&&(a=this.curvalue),this._setValue(a,!0))},_setOption:function(a,b){h.Widget.prototype._setOption.call(this,a,b);this._procOptions()},
increment:function(){this._doSpin(this.options.step)},decrement:function(){this._doSpin(-this.options.step)},showButtons:function(a){var b=this.btnContainer.stop();a?b.css("opacity",1):b.fadeTo("fast",1)},hideButtons:function(a){var b=this.btnContainer.stop();a?b.css("opacity",0):b.fadeTo("fast",0);this.buttons.removeClass(hover)},_setValue:function(a,b){this.curvalue=a=this._validate(a);this.element.val(null!=a?this.options.format(a,this.places,this.element):"");b||(this.selfChange=!0,this.element.change(),
this.selfChange=!1)},value:function(a){return arguments.length?(this._setValue(a),this.element):this.curvalue},enable:function(){this.buttons.removeClass(disabled);this.element[0].disabled=!1;h.Widget.prototype.enable.call(this)},disable:function(){this.buttons.addClass(disabled).removeClass(hover);this.element[0].disabled=!0;h.Widget.prototype.disable.call(this)},destroy:function(){this.wrapper.remove();this.element.unbind(".uispinner").removeClass("spinner-input");h.fn.mousewheel&&this.element.unmousewheel();
h.Widget.prototype.destroy.call(this)}})})(jQuery);