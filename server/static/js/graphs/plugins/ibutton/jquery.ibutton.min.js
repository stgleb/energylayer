/*!
 * iButton jQuery Plug-in
 *
 * Copyright 2011 Giva, Inc. (http://www.givainc.com/labs/) 
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * 	http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Date: 2011-07-26
 * Rev:  1.0.03
 *
 *
 * MoonCake v1.1 - iButton Plugin JS
 *
 * This file is part of MoonCake, an Admin template build for sale at ThemeForest.
 * For questions, suggestions or support request, please mail me at maimairel@yahoo.com
 *
 * Development Started:
 * July 28, 2012
 * Last Update:
 * October 10, 2012
 *
 * This file is a modification of iButton jQuery Plug-in from Giva-labs (http://www.givainc.com/labs/ibutton_jquery_plugin.htm)
 *
 * This plugin has been updated on v1.0.1 of MoonCake, with the following changes:
 * - Removed the 'return false' on the document mouseup, mousedown event as this might affect touch events globaly
 * - Moved the widths calculation to a custom local function that also will be called when calling 'repaint()'
 *
 */

;(function(c){c.iButton={version:"1.0.03",setDefaults:function(g){c.extend(A,g)}};c.fn.iButton=function(g){var a="string"==typeof arguments[0]&&arguments[0],j=a&&Array.prototype.slice.call(arguments,1)||arguments,b=0==this.length?null:c.data(this[0],"iButton");if(b&&a&&this.length){if("object"==a.toLowerCase())return b;if(b[a]){var e;this.each(function(g){var f=c.data(this,"iButton")[a].apply(b,j);if(0==g&&f)if(f.jquery)e=c([]).add(f);else return e=f,!1;else f&&f.jquery&&(e=e.add(f))});return e||this}return this}return this.each(function(){new E(this,
g)})};c(function(){c('[data-provide="ibutton"]').each(function(){var g=c(this);g.iButton(g.data())})});var F=0;c.browser.iphone=-1<navigator.userAgent.toLowerCase().indexOf("iphone");var E=function(g,a){var j=this,b=c(g),e=++F,m=!1,f,v,w,n,x=!1,p=null,B=null,q=null,C=null,a=c.extend({},A,a,b.data());if(b.is(":checkbox, :radio")){if(c.data(b[0],"iButton"))return}else return b.find(":checkbox, :radio").iButton(a);c.data(b[0],"iButton",j);b.parent().is("label")&&b.parent().bind("click.iButton",function(a){a.preventDefault()});
this.toggle=function(a){b.attr("checked",0<arguments.length?a:!b[0].checked).trigger("change")};this.disable=function(d){var y=0<arguments.length?d:!m;m=y;b.attr("disabled",y);h[y?"addClass":"removeClass"](a.classDisabled);c.isFunction(a.disable)&&a.disable.apply(j,[m,b,a])};this.repaint=function(){D();r()};this.destroy=function(){c([b[0],h[0]]).unbind(".iButton");b.parent().is("label")&&b.parent().unbind(".iButton");c(document).unbind(".iButton_"+e);h.after(b).remove();c.data(b[0],"iButton",null);
c.isFunction(a.destroy)&&a.destroy.apply(j,[b,a])};b.wrap('<div class="'+c.trim(a.classContainer+" "+a.className)+'" />').after('<div class="'+a.classHandle+'"><div class="'+a.classHandleInner+'" /></div><div class="'+a.classLabelOff+'"><span><label>'+a.labelOff+'</label></span></div><div class="'+a.classLabelOn+'"><span><label>'+a.labelOn+"</label></span></div>");var h=b.parent(),k=b.siblings("."+a.classHandle),s=b.siblings("."+a.classLabelOff),t=s.children("span"),l=b.siblings("."+a.classLabelOn),
u=l.children("span"),i,D=function(){f=u.outerWidth();v=t.outerWidth();w=Math.min(f,v);k.css("width",w);n=f+v;h.css("width",n+Math.max(parseInt(s.css("border-left-width"),10)+parseInt(s.css("border-right-width"),10),parseInt(l.css("border-left-width"),10)+parseInt(l.css("border-right-width"),10)));s.css("width",n);i=n-w};D();var r=function(d){var c=b[0].checked?i:0;(d=0<arguments.length?arguments[0]:!0)&&a.enableFx?(k.stop().animate({left:c},a.duration,a.easing),l.stop().animate({width:c},a.duration,
a.easing),u.stop().animate({marginLeft:c-i},a.duration,a.easing),t.stop().animate({marginRight:-c},a.duration,a.easing)):(k.css("left",c),l.css("width",c),u.css("marginLeft",c-i),t.css("marginRight",-c))};r(!1);var z=function(a){return a.pageX||(a.originalEvent.changedTouches?a.originalEvent.changedTouches[0].pageX:0)};h.bind("mousedown.iButton touchstart.iButton",function(d){if(!c(d.target).is(":checkbox, :radio")&&!(m||!a.allowRadioUncheck&&b.is(":radio:checked")))d.preventDefault(),p=k,B=z(d),
q=B-(parseInt(k.css("left"),10)||0),C=(new Date).getTime()});a.enableDrag&&c(document).bind("mousemove.iButton_"+e+" touchmove.iButton_"+e,function(b){p==k&&(b.preventDefault(),b=z(b),b!=q&&(x=!0,h.addClass(a.classHandleActive)),b=Math.min(1,Math.max(0,(b-q)/i)),k.css("left",b*i),l.css("width",b*i),t.css("marginRight",-b*i),u.css("marginLeft",-(1-b)*i))});c(document).bind("mouseup.iButton_"+e+" touchend.iButton_"+e,function(d){if(p==k){d.preventDefault();var e=!0;!x||(new Date).getTime()-C<a.clickOffset?
(d=b[0].checked,b.attr("checked",!d),c.isFunction(a.click)&&a.click.apply(j,[!d,b,a])):(d=0.5<=(z(d)-q)/i,b[0].checked==d&&(e=!1),b.attr("checked",d));h.removeClass(a.classHandleActive);x=p=null;e?b.trigger("change"):r()}});b.bind("change.iButton",function(){r();if(b.is(":radio")){var d=b[0];c(d.form?d.form[d.name]:":radio[name="+d.name+"]").filter(":not(:checked)").iButton("repaint")}c.isFunction(a.change)&&a.change.apply(j,[b,a])}).bind("focus.iButton",function(){h.addClass(a.classFocus)}).bind("blur.iButton",
function(){h.removeClass(a.classFocus)});c.isFunction(a.click)&&b.bind("click.iButton",function(){a.click.apply(j,[b[0].checked,b,a])});b.is(":disabled")&&this.disable(!0);c.browser.msie&&(h.find("*").andSelf().attr("unselectable","on"),b.bind("click.iButton",function(){b.triggerHandler("change.iButton")}));c.isFunction(a.init)&&a.init.apply(j,[b,a])},A={duration:200,easing:"swing",labelOn:"ON",labelOff:"OFF",enableDrag:!0,enableFx:!0,allowRadioUncheck:!1,clickOffset:120,className:"",classContainer:"ibutton-container",
classDisabled:"ibutton-disabled",classFocus:"ibutton-focus",classLabelOn:"ibutton-label-on",classLabelOff:"ibutton-label-off",classHandle:"ibutton-handle",classHandleInner:"ibutton-handle-inner",classHandleActive:"ibutton-active-handle",init:null,change:null,click:null,disable:null,destroy:null}})(jQuery);