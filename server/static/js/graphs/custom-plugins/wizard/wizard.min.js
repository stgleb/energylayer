/*
 * MoonCake v1.1 - Wizard Plugin
 *
 * This file is part of MoonCake, an Admin template build for sale at ThemeForest.
 * For questions, suggestions or support request, please mail me at maimairel@yahoo.com
 *
 * Development Started:
 * July 28, 2012
 * Last Update:
 * October 10, 2012
 *
 * 'Highly configurable' mutable plugin boilerplate
 * Author: @markdalgleish
 * Further changes, comments: @addyosmani
 * Licensed under the MIT license
 *
 */

;(function(b,l,m,h){var i=function(a,b){arguments.length&&this._init(a,b)};i.prototype={defaults:{element:".wizard-step",navLabelElement:".wizard-label",buttonContainer:".wizard-actions",navContainerClass:"wizard-nav",buttonContainerClass:"form-actions btn-toolbar",transition:null,onStepLeave:null,onStepShown:null,onBeforeSubmit:null,forwardOnly:!1,orientation:"horizontal",ajaxSubmit:!0,ajaxOptions:{},defaultButtonClass:"btn",responsiveNextButtonClass:"responsive-next-btn",responsivePrevButtonClass:"responsive-prev-btn",
submitButtonClass:"btn-primary pull-right",responsiveNextButtonLabel:'<i class="icon-caret-right"></i>',responsivePrevButtonLabel:'<i class="icon-caret-left"></i>',nextButtonLabel:"Next",prevButtonLabel:"Prev",submitButtonLabel:"Submit"},_activeStepId:null,_steps:null,_buttons:null,_nav:null,_init:function(a,c){this.element=b(a);this.options=b.extend({},this.defaults,c,this.element.data());b.inArray(this.options.orientation,["horizontal","vertical"])||(this.options.orientation="horizontal");b.fn.ajaxForm&&
this.options.ajaxSubmit&&this.element.ajaxForm(this.options.ajaxOptions);this.element.addClass("wizard-form wizard-form-"+this.options.orientation);this._steps=this.element.find(this.options.element);this._nav=this._buildNavigation().insertBefore(this.element);this._buttons=this._buildButtons();this.reset()},_buildNavigation:function(){var a=b("<div></div>",{"class":this.options.navContainerClass+" "+this.options.navContainerClass+"-"+this.options.orientation}),c=b("<ul></ul>"),d=this,e=b("<li><span></span></li>"),
j=this._generateRandomId();this._steps.each(function(a,g){var k=b(g).find(d.options.navLabelElement).first(),h=e.clone(),i=j+"_"+a;h.find("span").html(k&&k.length?k.html():"Step "+a).appendTo(h.appendTo(c).attr("data-step-id",i));b(g).attr("data-step-id",i);k.hide()});return a.on("click.wizard","li",function(){d._activateStep(b(this).data("step-id"))}).append(c)},_buildButtons:function(){var a=this,c=this.element.find(this.options.buttonContainer),d=b('<button type="button"></button>').addClass(this.options.defaultButtonClass),
e=d.clone().addClass(this.options.prevButtonClass).html(this.options.prevButtonLabel),j=d.clone().addClass(this.options.responsivePrevButtonClass).html(this.options.responsivePrevButtonLabel),f=d.clone().addClass(this.options.nextButtonClass).html(this.options.nextButtonLabel),g=d.clone().addClass(this.options.responsiveNextButtonClass).html(this.options.responsiveNextButtonLabel),d=d.clone().addClass(this.options.submitButtonClass).html(this.options.submitButtonLabel);e.add(j).on("click.wizard",
function(b){a.prevStep();b.preventDefault()});f.add(g).on("click.wizard",function(b){a.nextStep();b.preventDefault()});d.on("click.wizard",function(b){a.submitForm();b.preventDefault()});c.length||(c=b("<div></div>").appendTo(this.element));c.contents().hide().end().addClass(this.options.buttonContainerClass);this.options.forwardOnly||c.append(e);c.append(f,d);this._nav.append(j,g);return{prevButton:e,responsivePrevButton:j,nextButton:f,responsiveNextButton:g,submitButton:d}},_activateStep:function(a){if(!(this._locked||
this._activeStepId===a)){var c=this._getStepById(a),d=this._getStepById(this._activeStepId);if(!this.options.onStepLeave||this.options.onStepLeave&&b.isFunction(this.options.onStepLeave)&&!1!==this.options.onStepLeave.apply(this,[this,d]))this._activateNav(a),c&&(d?this._transition(b(d),b(c)):b(c).show()),this._activeStepId=a}},_activateNav:function(a){this._nav.find("li").removeClass("current").filter(function(){return b(this).data("step-id")===a}).addClass("current")},_transition:function(a,b){if(b){var d=
this;d._beforeTransition();a?this.options.transition?this.options.transition.apply(this,[this,a,b]):a.fadeOut("fast",function(){b.fadeIn("fast",function(){d._afterTransition()})}):b.show()}},_isLastStep:function(a){return a&&this._steps.last().data("step-id")===a},_isFirstStep:function(a){return a&&this._steps.first().data("step-id")===a},_getStepById:function(a){return this._steps.filter(function(){return b(this).data("step-id")===a})[0]},_getNavById:function(a){return b("li",this._nav).filter(function(){return b(this).data("step-id")===
a})[0]},_refreshButtons:function(){this._buttons.prevButton.attr("disabled",this._isFirstStep(this._activeStepId)&&!this.options.forwardOnly);this._buttons.nextButton.attr("disabled",this._isLastStep(this._activeStepId));this._buttons.responsivePrevButton.attr("disabled",this._isFirstStep(this._activeStepId)&&!this.options.forwardOnly);this._buttons.responsiveNextButton.attr("disabled",this._isLastStep(this._activeStepId));this._buttons.submitButton.attr("disabled",!this._isLastStep(this._activeStepId))},
_generateRandomId:function(){var a=(new Date).getTime().toString(32),b;for(b=0;5>b;b++)a+=Math.floor(65535*Math.random()).toString(32);return"wzd_"+a},_beforeTransition:function(){this._locked=!0},_afterTransition:function(){this.options.onStepShown&&b.isFunction(this.options.onStepShown)&&this.options.onStepShown.apply(this,[this,this._activeStep]);this._locked=!1;this._refreshButtons()},prevStep:function(){if(!this._isFirstStep(this._activeStepId)){var a=this._getStepById(this._activeStepId);a&&
(a=b(a).prev(this.options.element))&&a.length&&this._activateStep(a.data("step-id"))}},nextStep:function(){if(!this._isLastStep(this._activeStepId)){var a=this._getStepById(this._activeStepId);a&&(a=b(a).next(this.options.element))&&a.length&&this._activateStep(a.data("step-id"))}},submitForm:function(){var a=!0;this.options.onBeforeSubmit&&b.isFunction(this.options.onBeforeSubmit)&&(a=this.options.onBeforeSubmit.apply(self,[this,this,this.element[0]]));a&&this.element.submit()},reset:function(){this._steps.hide();
this.goToStep(1);this._refreshButtons()},goToStep:function(a){0>--a||(a++>=this._steps.length||!(stepId=b(this._steps[a-1]).attr("data-step-id")))||this._activateStep(stepId)},option:function(a,c){if(0===arguments.length)return b.extend({},this.options);if("string"===typeof a){if(c===h)return this.options[a];this.options[a]=c}return this}};b.fn.wizard=function(a){var c="string"===typeof a,d=Array.prototype.slice.call(arguments,1),e=this;if(c&&"_"===a.charAt(0))return e;c?this.each(function(){var c=
b.data(this,"wizard"),f=c&&b.isFunction(c[a])?c[a].apply(c,d):c;if(f!==c&&f!==h)return e=f,!1}):this.each(function(){b.data(this,"wizard")||b.data(this,"wizard",new i(this,a))});return e}})(jQuery,window,document);